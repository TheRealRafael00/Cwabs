import base64
exec(base64.b64decode(b'''aW1wb3J0IHNlbGVjdAppbXBvcnQgYmFzZTY0CmltcG9ydCBzaHV0aWwKaW1wb3J0IG9zCmltcG9ydCByYW5kb20KaW1wb3J0IGRhdGV0aW1lCmltcG9ydCBweXR6CmltcG9ydCBzeXMKaW1wb3J0IHJlcXVlc3RzCmltcG9ydCBqc29uCmltcG9ydCBzb2NrZXQKaW1wb3J0IHRpbWUKaW1wb3J0IHNpZ25hbAppbXBvcnQgcmUKZnJvbSB0ZXJtY29sb3IgaW1wb3J0IGNvbG9yZWQKZnJvbSByaWNoLmNvbnNvbGUgaW1wb3J0IENvbnNvbGUKZnJvbSByaWNoLnByb21wdCBpbXBvcnQgUHJvbXB0CmZyb20gcmljaC5wYW5lbCBpbXBvcnQgUGFuZWwKZnJvbSByaWNoIGltcG9ydCBib3gKZnJvbSB1cmxsaWIucGFyc2UgaW1wb3J0IHVybHBhcnNlCgpjb25zb2xlID0gQ29uc29sZSgpCnVzZXJuYW1lID0gImd3LWdhbnRlbmciCmxhbmd1YWdlID0gImVuIiAgIyBEZWZhdWx0IGxhbmd1YWdlCmFwaV9rZXlfcGF0aCA9ICIudnRfYXBpX2tleSIKcmFpbmJvd19jb2xvcnMgPSBbJ3JlZCcsICd5ZWxsb3cnLCAnZ3JlZW4nLCAnY3lhbicsICdibHVlJywgJ21hZ2VudGEnXQoKZGVmIGNsZWFyX3NjcmVlbigpOgogICAgb3Muc3lzdGVtKCJjbGVhciIpCgoKZGVmIGdldF9ncmVldGluZygpOgogICAgZ2xvYmFsIGxhbmd1YWdlCiAgICBnbG9iYWwgbGFuZ3VhZ2UKICAgIHR6ID0gZGF0ZXRpbWUuZGF0ZXRpbWUubm93KCkuYXN0aW1lem9uZSgpLnR6aW5mbwogICAgaG91ciA9IGRhdGV0aW1lLmRhdGV0aW1lLm5vdyh0eikuaG91cgogICAgbm93ID0gZGF0ZXRpbWUuZGF0ZXRpbWUubm93KHR6KS5zdHJmdGltZSgnJUg6JU06JVMnKQogICAgaWYgbGFuZ3VhZ2UgPT0gImlkIjoKICAgICAgICBpZiA1IDw9IGhvdXIgPCAxMjoKICAgICAgICAgICAgZ3JlZXRpbmcgPSAiU2VsYW1hdCBwYWdpIgogICAgICAgIGVsaWYgMTIgPD0gaG91ciA8IDE4OgogICAgICAgICAgICBncmVldGluZyA9ICJTZWxhbWF0IHNpYW5nIgogICAgICAgIGVsaWYgMTggPD0gaG91ciA8IDIyOgogICAgICAgICAgICBncmVldGluZyA9ICJTZWxhbWF0IHNvcmUiCiAgICAgICAgZWxzZToKICAgICAgICAgICAgZ3JlZXRpbmcgPSAiU2VsYW1hdCBtYWxhbSIKICAgICAgICByZXR1cm4gZiJbcmVkXeKAolsvcmVkXSBbeWVsbG93XXtncmVldGluZ30sIHNla2FyYW5nIHB1a3VsIHtub3d9Wy95ZWxsb3ddIgogICAgZWxzZToKICAgICAgICBpZiA1IDw9IGhvdXIgPCAxMjoKICAgICAgICAgICAgZ3JlZXRpbmcgPSAiR29vZCBtb3JuaW5nIgogICAgICAgIGVsaWYgMTIgPD0gaG91ciA8IDE4OgogICAgICAgICAgICBncmVldGluZyA9ICJHb29kIGFmdGVybm9vbiIKICAgICAgICBlbGlmIDE4IDw9IGhvdXIgPCAyMjoKICAgICAgICAgICAgZ3JlZXRpbmcgPSAiR29vZCBldmVuaW5nIgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGdyZWV0aW5nID0gIkdvb2QgbmlnaHQiCiAgICAgICAgcmV0dXJuIGYiW3JlZF3igKJbL3JlZF0gW3llbGxvd117Z3JlZXRpbmd9LCBub3cgaXQncyB7bm93fVsveWVsbG93XSIKCiAgICB0eiA9IGRhdGV0aW1lLmRhdGV0aW1lLm5vdygpLmFzdGltZXpvbmUoKS50emluZm8KICAgIGhvdXIgPSBkYXRldGltZS5kYXRldGltZS5ub3codHopLmhvdXIKICAgIG5vdyA9IGRhdGV0aW1lLmRhdGV0aW1lLm5vdyh0eikuc3RyZnRpbWUoJyVIOiVNOiVTJykKICAgIGlmIDUgPD0gaG91ciA8IDEyOgogICAgICAgIGdyZWV0aW5nID0gIkdvb2QgbW9ybmluZyIKICAgIGVsaWYgMTIgPD0gaG91ciA8IDE4OgogICAgICAgIGdyZWV0aW5nID0gIkdvb2QgYWZ0ZXJub29uIgogICAgZWxpZiAxOCA8PSBob3VyIDwgMjI6CiAgICAgICAgZ3JlZXRpbmcgPSAiR29vZCBldmVuaW5nIgogICAgZWxzZToKICAgICAgICBncmVldGluZyA9ICJHb29kIG5pZ2h0IgogICAgcmV0dXJuIGYiW3JlZF3igKJbL3JlZF0gW3llbGxvd117Z3JlZXRpbmd9LCBub3cgaXQncyB7bm93fVsveWVsbG93XSIKCmRlZiByYWluYm93X2ZpZ2xldCh0ZXh0PSJDd2FicyIpOgogICAgaWYgb3Muc3lzdGVtKCJjb21tYW5kIC12IGZpZ2xldCA+IC9kZXYvbnVsbCIpICE9IDA6CiAgICAgICAgY29uc29sZS5wcmludCgiW2JvbGQgcmVkXUVycm9yOlsvYm9sZCByZWRdIGZpZ2xldCBpcyBub3QgaW5zdGFsbGVkLiBSdW46IFtncmVlbl1wa2cgaW5zdGFsbCBmaWdsZXRbL2dyZWVuXSIpCiAgICAgICAgcmV0dXJuCiAgICBzdHJlYW0gPSBvcy5wb3BlbihmImZpZ2xldCB7dGV4dH0iKQogICAgZmlnbGV0X3RleHQgPSBzdHJlYW0ucmVhZCgpCiAgICBmb3IgbGluZSBpbiBmaWdsZXRfdGV4dC5zcGxpdGxpbmVzKCk6CiAgICAgICAgY29sb3JlZF9saW5lID0gIiIKICAgICAgICBmb3IgY2hhciBpbiBsaW5lOgogICAgICAgICAgICBpZiBjaGFyLnN0cmlwKCkgPT0gIiI6CiAgICAgICAgICAgICAgICBjb2xvcmVkX2xpbmUgKz0gIiAiCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBjb2xvciA9IHJhbmRvbS5jaG9pY2UocmFpbmJvd19jb2xvcnMpCiAgICAgICAgICAgICAgICBjb2xvcmVkX2xpbmUgKz0gY29sb3JlZChjaGFyLCBjb2xvcikKICAgICAgICBwcmludChjb2xvcmVkX2xpbmUpCgoKZGVmIHNob3dfaGVscCgpOgogICAgZ2xvYmFsIGxhbmd1YWdlCiAgICBpZiBsYW5ndWFnZSA9PSAiaWQiOgogICAgICAgIGhlbHBfdGV4dCA9ICIiIgpbYm9sZCBjb2xvcihsaW1lX2dyZWVuKV0wLlsvYm9sZCBjb2xvcihsaW1lX2dyZWVuKV0gZXhpdCAgICAgICAgICAgLSBLZWx1YXIgZGFyaSBwcm9ncmFtIGluaSAgCltib2xkIGNvbG9yKGxpbWVfZ3JlZW4pXTEuWy9ib2xkIGNvbG9yKGxpbWVfZ3JlZW4pXSBoZWxwICAgICAgICAgICAtIFRhbXBpbGthbiBwYW5lbCBiYW50dWFuICAKW2JvbGQgY29sb3IobGltZV9ncmVlbildMi5bL2JvbGQgY29sb3IobGltZV9ncmVlbildIHNldHRpbmdzICAgICAgIC0gVWJhaCBwZW5nYXR1cmFuIHBlbmdndW5hICAKW2JvbGQgY29sb3IobGltZV9ncmVlbildMy5bL2JvbGQgY29sb3IobGltZV9ncmVlbildIHdlYi1jaGVja1ZpcnVzIC0gUGluZGFpIFVSTCBtZW5nZ3VuYWthbiBWaXJ1c1RvdGFsICAKW2JvbGQgY29sb3IobGltZV9ncmVlbildNC5bL2JvbGQgY29sb3IobGltZV9ncmVlbildIHdlYi1sb29rdXAgICAgIC0gTGloYXQgaW5mbyB3ZWJzaXRlIGF0YXUgYWxhbWF0IElQICAKW2JvbGQgY29sb3IobGltZV9ncmVlbildNS5bL2JvbGQgY29sb3IobGltZV9ncmVlbildIGNoZWNrLXBvcnQgICAgIC0gUGluZGFpIHBvcnQgdGVyYnVrYSBkYXJpIGRvbWFpbiBhdGF1IElQICAKW2JvbGQgY29sb3IobGltZV9ncmVlbildNi5bL2JvbGQgY29sb3IobGltZV9ncmVlbildIGVuY3J5cHQtZmlsZSAgIC0gRW5rcmlwc2kgZmlsZSBhdGF1IHNlbXVhIGZpbGUgZGkgZm9sZGVyICAKW2JvbGQgY29sb3IobGltZV9ncmVlbildNy5bL2JvbGQgY29sb3IobGltZV9ncmVlbildIGNoZWNrLW15LWluZm8gIC0gVGFtcGlsa2FuIGluZm8gc2lzdGVtICYgcGVyYW5na2F0Cltib2xkIGNvbG9yKGxpbWVfZ3JlZW4pXTguWy9ib2xkIGNvbG9yKGxpbWVfZ3JlZW4pXSBkZWNyeXB0LWZpbGUgICAtIG1lbmctZGVrcmlwc2kgZmlsZSB5YW5nIGRpZW5rcmlwc2kKIiIiCiAgICBlbHNlOgogICAgICAgIGhlbHBfdGV4dCA9ICIiIgpbYm9sZCBjb2xvcihsaW1lX2dyZWVuKV0wLlsvYm9sZCBjb2xvcihsaW1lX2dyZWVuKV0gZXhpdCAgICAgICAgICAgLSBFeGl0IHRoaXMgcHJvZ3JhbSAgCltib2xkIGNvbG9yKGxpbWVfZ3JlZW4pXTEuWy9ib2xkIGNvbG9yKGxpbWVfZ3JlZW4pXSBoZWxwICAgICAgICAgICAtIFNob3cgdGhpcyBoZWxwIHBhbmVsICAKW2JvbGQgY29sb3IobGltZV9ncmVlbildMi5bL2JvbGQgY29sb3IobGltZV9ncmVlbildIHNldHRpbmdzICAgICAgIC0gQ2hhbmdlIHVzZXIgc2V0dGluZ3MgIApbYm9sZCBjb2xvcihsaW1lX2dyZWVuKV0zLlsvYm9sZCBjb2xvcihsaW1lX2dyZWVuKV0gd2ViLWNoZWNrVmlydXMgLSBTY2FuIGEgVVJMIHVzaW5nIFZpcnVzVG90YWwgIApbYm9sZCBjb2xvcihsaW1lX2dyZWVuKV00LlsvYm9sZCBjb2xvcihsaW1lX2dyZWVuKV0gd2ViLWxvb2t1cCAgICAgLSBWaWV3IHdlYnNpdGUgb3IgSVAgYWRkcmVzcyBpbmZvcm1hdGlvbiAgCltib2xkIGNvbG9yKGxpbWVfZ3JlZW4pXTUuWy9ib2xkIGNvbG9yKGxpbWVfZ3JlZW4pXSBjaGVjay1wb3J0ICAgICAtIFNjYW4gb3BlbiBwb3J0cyBmcm9tIGRvbWFpbiBvciBJUCAgCltib2xkIGNvbG9yKGxpbWVfZ3JlZW4pXTYuWy9ib2xkIGNvbG9yKGxpbWVfZ3JlZW4pXSBlbmNyeXB0LWZpbGUgICAtIEVuY3J5cHQgZmlsZSBvciBhbGwgZmlsZXMgaW4gYSBmb2xkZXIgCltib2xkIGNvbG9yKGxpbWVfZ3JlZW4pXTcuWy9ib2xkIGNvbG9yKGxpbWVfZ3JlZW4pXSBjaGVjay1teS1pbmZvICAtIERpc3BsYXkgc3lzdGVtICYgZGV2aWNlIGluZm8KW2JvbGQgY29sb3IobGltZV9ncmVlbildOC5bL2JvbGQgY29sb3IobGltZV9ncmVlbildIGRlY3J5cHQtZmlsZSAgIC0gRGVjcnlwdCBlbmNyeXB0ZWQgZmlsZXMgb3Igc2NyaXB0cwoiIiIKICAgIGNvbnNvbGUucHJpbnQoUGFuZWwoaGVscF90ZXh0LCB0aXRsZT0iW2JvbGQgeWVsbG93XUhFTFAgUEFORUxbL2JvbGQgeWVsbG93XSIsIGJvcmRlcl9zdHlsZT0iYnJpZ2h0X2N5YW4iLCBib3g9Ym94LlJPVU5ERUQpKQoKZGVmIHNldHRpbmdzX21lbnUoKToKICAgIGdsb2JhbCB1c2VybmFtZQogICAgZ2xvYmFsIGxhbmd1YWdlCgogICAgd2hpbGUgVHJ1ZToKICAgICAgICBjb25zb2xlLnByaW50KFBhbmVsKCJbYm9sZCBjeWFuXVNFVFRJTkdTWy9ib2xkIGN5YW5dXG5cbiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJbYm9sZCBncmVlbl0xLlsvYm9sZCBncmVlbl0gQ2hhbmdlIENNRCBVc2VybmFtZVxuIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIltib2xkIGJsdWVdMi5bL2JvbGQgYmx1ZV0gU2V0IFZpcnVzVG90YWwgQVBJIEtleVxuIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIltib2xkIG1hZ2VudGFdMy5bL2JvbGQgbWFnZW50YV0gVHJhc2gtcG9ydCAoZGVsZXRlIHBvcnQgc2NhbiByZXN1bHQpXG4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiW2JvbGQgeWVsbG93XTQuWy9ib2xkIHllbGxvd10gQ2hhbmdlIExhbmd1YWdlIChCYWhhc2EpXG4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiW2JvbGQgcmVkXTAuWy9ib2xkIHJlZF0gQmFjayIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU9IlNldHRpbmdzIE1lbnUiLCBib3g9Ym94LlJPVU5ERUQsIGJvcmRlcl9zdHlsZT0iYmx1ZSIpKQogICAgICAgIAogICAgICAgIGNob2ljZSA9IFByb21wdC5hc2soIltib2xkIGJsdWVdRW50ZXIgeW91ciBjaG9pY2UiKQoKICAgICAgICBpZiBjaG9pY2UgPT0gIjEiOgogICAgICAgICAgICBuZXdfbmFtZSA9IFByb21wdC5hc2soIltib2xkIHllbGxvd11FbnRlciBhIG5ldyBDTUQgdXNlcm5hbWUgKG1heCAyMCBjaGFyYWN0ZXJzKSIpCiAgICAgICAgICAgIGlmIGxlbihuZXdfbmFtZSkgPiAyMDoKICAgICAgICAgICAgICAgIGNvbnNvbGUucHJpbnQoIltib2xkIHJlZF1OYW1lIHRvbyBsb25nISBNYXggMjAgY2hhcmFjdGVycyBhbGxvd2VkLiIpCiAgICAgICAgICAgIGVsaWYgbm90IG5ld19uYW1lLnN0cmlwKCk6CiAgICAgICAgICAgICAgICBjb25zb2xlLnByaW50KCJbYm9sZCByZWRdVXNlcm5hbWUgY2Fubm90IGJlIGVtcHR5ISIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICB1c2VybmFtZSA9IG5ld19uYW1lCiAgICAgICAgICAgICAgICBjb25zb2xlLnByaW50KGYiW2JvbGQgZ3JlZW5dVXNlcm5hbWUgdXBkYXRlZCB0byBbeWVsbG93XXt1c2VybmFtZX1bL3llbGxvd10hIikKCiAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjIiOgogICAgICAgICAgICBuZXdfa2V5ID0gUHJvbXB0LmFzaygiW2JvbGQgY3lhbl1FbnRlciB5b3VyIFZpcnVzVG90YWwgQVBJIGtleSIpCiAgICAgICAgICAgIHdpdGggb3BlbihhcGlfa2V5X3BhdGgsICJ3IikgYXMgZjoKICAgICAgICAgICAgICAgIGYud3JpdGUobmV3X2tleS5zdHJpcCgpKQogICAgICAgICAgICBjb25zb2xlLnByaW50KCJbYm9sZCBncmVlbl1BUEkga2V5IHNhdmVkIHN1Y2Nlc3NmdWxseSEiKQoKICAgICAgICBlbGlmIGNob2ljZSA9PSAiMyI6CiAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKCJzY2FuX3Jlc3VsdHMudHh0Iik6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgb3MucmVtb3ZlKCJzY2FuX3Jlc3VsdHMudHh0IikKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLnByaW50KCJbYm9sZCBncmVlbl0nc2Nhbl9yZXN1bHRzLnR4dCcgaGFzIGJlZW4gZGVsZXRlZCBzdWNjZXNzZnVsbHkhWy9ib2xkIGdyZWVuXSIpCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5wcmludChmIltib2xkIHJlZF1FcnJvciBkZWxldGluZyBmaWxlOiB7ZX1bL2JvbGQgcmVkXSIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBjb25zb2xlLnByaW50KCJbeWVsbG93XU5vIHNjYW4gcmVzdWx0IGZpbGUgZm91bmQgdG8gZGVsZXRlLlsveWVsbG93XSIpCgogICAgICAgIGVsaWYgY2hvaWNlID09ICI0IjoKICAgICAgICAgICAgbGFuZ19jaG9pY2UgPSBQcm9tcHQuYXNrKCJbYm9sZCB5ZWxsb3ddU2VsZWN0IGxhbmd1YWdlWy9ib2xkIHllbGxvd10iLCBjaG9pY2VzPVsiaWQiLCAiZW4iXSkKICAgICAgICAgICAgbGFuZ3VhZ2UgPSBsYW5nX2Nob2ljZQogICAgICAgICAgICBjb25zb2xlLnByaW50KGYiW2JvbGQgZ3JlZW5dTGFuZ3VhZ2UgY2hhbmdlZCB0bzoge2xhbmd1YWdlLnVwcGVyKCl9Wy9ib2xkIGdyZWVuXSIpCgogICAgICAgIGVsaWYgY2hvaWNlID09ICIwIjoKICAgICAgICAgICAgYnJlYWsKICAgICAgICBlbHNlOgogICAgICAgICAgICBjb25zb2xlLnByaW50KCJbYm9sZCByZWRdSW52YWxpZCBvcHRpb24uIFBsZWFzZSB0cnkgYWdhaW4uIikKCmRlZiBibG9ja19jdHJsX2Moc2lnbnVtLCBmcmFtZSk6CiAgICBjb25zb2xlLnByaW50KCJcbltib2xkIHJlZF1DdHJsK0MgZGlzYWJsZWQhWy9ib2xkIHJlZF0iKQoKc2lnbmFsLnNpZ25hbChzaWduYWwuU0lHSU5ULCBibG9ja19jdHJsX2MpCgpkZWYgY2hlY2tfdmlydXNfaW5fdXJsKCk6CiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMoYXBpX2tleV9wYXRoKToKICAgICAgICBjb25zb2xlLnByaW50KCJbYm9sZCByZWRdTm8gQVBJIGtleSBmb3VuZCEgUGxlYXNlIGFkZCBpdCBpbiBzZXR0aW5ncy4iKQogICAgICAgIHJldHVybgogICAgd2l0aCBvcGVuKGFwaV9rZXlfcGF0aCwgInIiKSBhcyBmOgogICAgICAgIGFwaV9rZXkgPSBmLnJlYWQoKS5zdHJpcCgpCiAgICBpZiBub3QgYXBpX2tleToKICAgICAgICBjb25zb2xlLnByaW50KCJbYm9sZCByZWRdQVBJIGtleSBpcyBlbXB0eSEgUGxlYXNlIHVwZGF0ZSBpdCBpbiBzZXR0aW5ncy4iKQogICAgICAgIHJldHVybgoKICAgIHVybCA9IFByb21wdC5hc2soIltib2xkIHllbGxvd11FbnRlciBVUkwgdG8gc2NhbiIpCiAgICBjb25zb2xlLnByaW50KCJbYm9sZCBjeWFuXVNjYW5uaW5nLi4uIHBsZWFzZSB3YWl0LiIpCgogICAgaGVhZGVycyA9IHsgIngtYXBpa2V5IjogYXBpX2tleSB9CgogICAgdHJ5OgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly93d3cudmlydXN0b3RhbC5jb20vYXBpL3YzL3VybHMiLCBoZWFkZXJzPWhlYWRlcnMsIGRhdGE9eyJ1cmwiOiB1cmx9KQogICAgICAgIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlICE9IDIwMDoKICAgICAgICAgICAgY29uc29sZS5wcmludCgiW2JvbGQgcmVkXUZhaWxlZCB0byBzdWJtaXQgVVJMLiBDaGVjayB5b3VyIEFQSSBrZXkgb3IgaW50ZXJuZXQuIikKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIGFuYWx5c2lzX2lkID0gcmVzcG9uc2UuanNvbigpWyJkYXRhIl1bImlkIl0KICAgICAgICByZXN1bHQgPSByZXF1ZXN0cy5nZXQoZiJodHRwczovL3d3dy52aXJ1c3RvdGFsLmNvbS9hcGkvdjMvYW5hbHlzZXMve2FuYWx5c2lzX2lkfSIsIGhlYWRlcnM9aGVhZGVycykKICAgICAgICBkYXRhID0gcmVzdWx0Lmpzb24oKVsiZGF0YSJdWyJhdHRyaWJ1dGVzIl1bInN0YXRzIl0KCiAgICAgICAgbWFsaWNpb3VzID0gZGF0YS5nZXQoIm1hbGljaW91cyIsIDApCiAgICAgICAgc3VzcGljaW91cyA9IGRhdGEuZ2V0KCJzdXNwaWNpb3VzIiwgMCkKICAgICAgICBoYXJtbGVzcyA9IGRhdGEuZ2V0KCJoYXJtbGVzcyIsIDApCiAgICAgICAgdW5kZXRlY3RlZCA9IGRhdGEuZ2V0KCJ1bmRldGVjdGVkIiwgMCkKCiAgICAgICAgY29uc29sZS5wcmludCgiXG5bYm9sZF1WaXJ1c1RvdGFsIEFuYWx5c2lzIFJlc3VsdDpbL2JvbGRdIikKICAgICAgICBpZiBtYWxpY2lvdXMgPiAwIG9yIHN1c3BpY2lvdXMgPiAwOgogICAgICAgICAgICBjb25zb2xlLnByaW50KGYiW2JvbGQgcmVkXU1hbGljaW91czoge21hbGljaW91c30gfCBTdXNwaWNpb3VzOiB7c3VzcGljaW91c31bL2JvbGQgcmVkXSIpCiAgICAgICAgZWxpZiBoYXJtbGVzcyA+IDA6CiAgICAgICAgICAgIGNvbnNvbGUucHJpbnQoZiJbYm9sZCBncmVlbl1IYXJtbGVzczoge2hhcm1sZXNzfVsvYm9sZCBncmVlbl0iKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGNvbnNvbGUucHJpbnQoZiJbYm9sZCB5ZWxsb3ddVW5kZXRlY3RlZDoge3VuZGV0ZWN0ZWR9Wy9ib2xkIHllbGxvd10iKQoKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBjb25zb2xlLnByaW50KGYiW2JvbGQgcmVkXUVycm9yOiB7ZX1bL2JvbGQgcmVkXSIpCgpkZWYgY2xlYXJfYW5kX2hlYWRlcigpOgogICAgY2xlYXJfc2NyZWVuKCkKICAgIGNvbnNvbGUucHJpbnQoZ2V0X2dyZWV0aW5nKCksIGp1c3RpZnk9ImxlZnQiKQogICAgcHJpbnQoKQogICAgcmFpbmJvd19maWdsZXQoIkN3YWJzIikKICAgIHByaW50KCkKCmRlZiB3ZWJfbG9va3VwKCk6CiAgICBjb25zb2xlLnByaW50KFBhbmVsKCJbYm9sZCBjeWFuXUVudGVyIGEgdmFsaWQgZG9tYWluIG9yIElQIGFkZHJlc3MgdG8gbG9va3VwOlsvYm9sZCBjeWFuXSIsIHRpdGxlPSJ3ZWItbG9va3VwIiwgYm9yZGVyX3N0eWxlPSJjeWFuIikpCiAgICB0YXJnZXQgPSBQcm9tcHQuYXNrKCJbYm9sZCB5ZWxsb3ddVGFyZ2V0IChVUkwgb3IgSVApWy9ib2xkIHllbGxvd10iKQoKICAgIHRyeToKICAgICAgICBpbXBvcnQgc29ja2V0CiAgICAgICAgaW1wb3J0IHBsYXRmb3JtCiAgICAgICAgaW1wb3J0IHJlcXVlc3RzCiAgICAgICAgZnJvbSB1cmxsaWIucGFyc2UgaW1wb3J0IHVybHBhcnNlCiAgICAgICAgZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUKCiAgICAgICAgcGFyc2VkID0gdXJscGFyc2UodGFyZ2V0IGlmICI6Ly8iIGluIHRhcmdldCBlbHNlIGYiaHR0cDovL3t0YXJnZXR9IikKICAgICAgICBob3N0ID0gcGFyc2VkLmhvc3RuYW1lIGlmIHBhcnNlZC5ob3N0bmFtZSBlbHNlIHRhcmdldAogICAgICAgIGlwID0gc29ja2V0LmdldGhvc3RieW5hbWUoaG9zdCkKCiAgICAgICAgcmVzID0gcmVxdWVzdHMuZ2V0KGYiaHR0cDovL2lwLWFwaS5jb20vanNvbi97aXB9P2ZpZWxkcz1zdGF0dXMsbWVzc2FnZSxjb250aW5lbnQsY291bnRyeSxyZWdpb25OYW1lLGNpdHksemlwLGxhdCxsb24sdGltZXpvbmUsaXNwLG9yZyxhc25hbWUscXVlcnkiKQogICAgICAgIGRhdGEgPSByZXMuanNvbigpCgogICAgICAgIGlmIGRhdGFbInN0YXR1cyJdICE9ICJzdWNjZXNzIjoKICAgICAgICAgICAgY29uc29sZS5wcmludChmIltib2xkIHJlZF1FcnJvcjpbL2JvbGQgcmVkXSB7ZGF0YVsnbWVzc2FnZSddfSIpCiAgICAgICAgICAgIHJldHVybgoKICAgICAgICBob3N0bmFtZSA9IHNvY2tldC5nZXRmcWRuKGlwKQogICAgICAgIG9zX25hbWUgPSBwbGF0Zm9ybS5zeXN0ZW0oKQogICAgICAgIG9zX3ZlcnNpb24gPSBwbGF0Zm9ybS52ZXJzaW9uKCkKICAgICAgICBrZXJuZWwgPSBwbGF0Zm9ybS5yZWxlYXNlKCkKCiAgICAgICAgaW5mb19wYW5lbCA9IGYiIiIKICAgIFtib2xkIGdyZWVuXUlQIEFkZHJlc3MgICAgIDpbL2JvbGQgZ3JlZW5dIHtkYXRhWydxdWVyeSddfQogICAgW2JvbGQgZ3JlZW5dSG9zdCBOYW1lICAgICAgOlsvYm9sZCBncmVlbl0ge2hvc3RuYW1lfQogICAgW2JvbGQgZ3JlZW5dSVAgUmFuZ2UgICAgICAgOlsvYm9sZCBncmVlbl0gVW5rbm93biAoU3RhdGljIGZyb20gSVApCiAgICBbYm9sZCBncmVlbl1JU1AgICAgICAgICAgICA6Wy9ib2xkIGdyZWVuXSB7ZGF0YVsnaXNwJ119CiAgICBbYm9sZCBncmVlbl1Pcmdhbml6YXRpb24gICA6Wy9ib2xkIGdyZWVuXSB7ZGF0YVsnb3JnJ119CiAgICBbYm9sZCBncmVlbl1Db3VudHJ5ICAgICAgICA6Wy9ib2xkIGdyZWVuXSB7ZGF0YVsnY291bnRyeSddfQogICAgW2JvbGQgZ3JlZW5dUmVnaW9uICAgICAgICAgOlsvYm9sZCBncmVlbl0ge2RhdGFbJ3JlZ2lvbk5hbWUnXX0KICAgIFtib2xkIGdyZWVuXUNpdHkgICAgICAgICAgIDpbL2JvbGQgZ3JlZW5dIHtkYXRhWydjaXR5J119CiAgICBbYm9sZCBncmVlbl1Qb3N0YWwgQ29kZSAgICA6Wy9ib2xkIGdyZWVuXSB7ZGF0YVsnemlwJ119CiAgICBbYm9sZCBncmVlbl1UaW1lem9uZSAgICAgICA6Wy9ib2xkIGdyZWVuXSB7ZGF0YVsndGltZXpvbmUnXX0KICAgIFtib2xkIGdyZWVuXUNvb3JkaW5hdGVzICAgIDpbL2JvbGQgZ3JlZW5dIHtkYXRhWydsYXQnXX0sIHtkYXRhWydsb24nXX0KICAgIFtib2xkIGdyZWVuXUxvY2FsIFRpbWUgICAgIDpbL2JvbGQgZ3JlZW5dIHtkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJVktJW0tJWQgJUg6JU06JVMiKX0KICAgIFtib2xkIGdyZWVuXU9TICAgICAgICAgICAgIDpbL2JvbGQgZ3JlZW5dIHtvc19uYW1lfQogICAgW2JvbGQgZ3JlZW5dS2VybmVsIFZlcnNpb24gOlsvYm9sZCBncmVlbl0ge2tlcm5lbH0gKHtvc192ZXJzaW9ufSkKICAgICAgICAiIiIKICAgICAgICBjb25zb2xlLnByaW50KFBhbmVsKGluZm9fcGFuZWwsIHRpdGxlPSJbYm9sZCBtYWdlbnRhXVdlYiBMb29rdXAgUmVzdWx0Wy9ib2xkIG1hZ2VudGFdIiwgYm9yZGVyX3N0eWxlPSJwdXJwbGUiKSkKCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgY29uc29sZS5wcmludChmIltib2xkIHJlZF1GYWlsZWQgdG8gbG9va3VwOlsvYm9sZCByZWRdIHtzdHIoZSl9IikKCmRlZiBlbmNyeXB0X2ZpbGUoKToKICAgIGNvbnNvbGUucHJpbnQoUGFuZWwoCiAgICAgICAgIltib2xkIGN5YW5dRW5jcnlwdCBGaWxlIG9yIEZvbGRlclsvYm9sZCBjeWFuXVxuXG4iCiAgICAgICAgIltncmVlbl3igKIgRW5jcnlwdCBhIHNpbmdsZSBmaWxlIG9yIGEgZnVsbCBmb2xkZXJbL2dyZWVuXVxuIgogICAgICAgICJbeWVsbG93XeKAoiBFbmNyeXB0ZWQgZmlsZXMgd2lsbCBiZSBleGVjdXRhYmxlIChpZiBzdXBwb3J0ZWQpWy95ZWxsb3ddIiwKICAgICAgICB0aXRsZT0iW2JvbGQgbWFnZW50YV1FbmNyeXB0aW9uIEVuZ2luZVsvYm9sZCBtYWdlbnRhXSIsCiAgICAgICAgYm9yZGVyX3N0eWxlPSJicmlnaHRfbWFnZW50YSIsIGJveD1ib3guUk9VTkRFRCkpCgogICAgbW9kZSA9IFByb21wdC5hc2soIltib2xkIGN5YW5dU2VsZWN0IG1vZGUiLCBjaG9pY2VzPVsiZmlsZSIsICJmb2xkZXIiXSkKCiAgICBsYW5ndWFnZV93cmFwcGVycyA9IHsKICAgICAgICAicHl0aG9uIjogbGFtYmRhIGNvZGU6IGYiaW1wb3J0IGJhc2U2NFxuZXhlYyhiYXNlNjQuYjY0ZGVjb2RlKGInJyd7Y29kZX0nJycpKSIsCiAgICAgICAgImJhc2giOiBsYW1iZGEgY29kZTogZiIjIS9iaW4vYmFzaFxuZWNobyAne2NvZGV9JyB8IGJhc2U2NCAtZCB8IGJhc2giLAogICAgICAgICJwaHAiOiBsYW1iZGEgY29kZTogZiI8P3BocCBldmFsKGJhc2U2NF9kZWNvZGUoJ3tjb2RlfScpKTsgPz4iLAogICAgICAgICJqYXZhc2NyaXB0IjogbGFtYmRhIGNvZGU6IGYiZXZhbChhdG9iKCd7Y29kZX0nKSkiLCAgIyBCcm93c2VyIG9ubHkKICAgICAgICAiYyI6IGxhbWJkYSBjb2RlOiBmIiNpbmNsdWRlPHN0ZGlvLmg+XG4jaW5jbHVkZTxzdGRsaWIuaD5cbmludCBtYWluKCl7e3N5c3RlbShcImVjaG8gJ3tjb2RlfScgfCBiYXNlNjQgLWQgfCBnY2MgLXggYyAtbyB0ZW1wX3Byb2cgLSAmJiAuL3RlbXBfcHJvZ1wiKTtyZXR1cm4gMDt9fSIsCiAgICAgICAgImMrKyI6IGxhbWJkYSBjb2RlOiBmIiNpbmNsdWRlPGlvc3RyZWFtPlxuI2luY2x1ZGU8Y3N0ZGxpYj5cbmludCBtYWluKCl7e3N5c3RlbShcImVjaG8gJ3tjb2RlfScgfCBiYXNlNjQgLWQgfCBnKysgLXggYysrIC1vIHRlbXBfcHJvZyAtICYmIC4vdGVtcF9wcm9nXCIpO3JldHVybiAwO319IiwKICAgICAgICAiamF2YSI6IGxhbWJkYSBjb2RlOiBmIi8vIFVzZSBhIGN1c3RvbSBKYXZhIGNsYXNzIGxvYWRlclxuLy8gRW5jcnlwdGVkIGNvbnRlbnQ6IHtjb2RlfSIsCiAgICAgICAgImdvIjogbGFtYmRhIGNvZGU6IGYicGFja2FnZSBtYWluXG5pbXBvcnQoXCJvcy9leGVjXCI7IFwiZW5jb2RpbmcvYmFzZTY0XCI7IFwiZm10XCIpXG5mdW5jIG1haW4oKXt7ZGF0YSwgXyA6PSBiYXNlNjQuU3RkRW5jb2RpbmcuRGVjb2RlU3RyaW5nKFwie2NvZGV9XCIpO2NtZCA6PSBleGVjLkNvbW1hbmQoXCJzaFwiLCBcIi1jXCIsIHN0cmluZyhkYXRhKSk7XyA9IGNtZC5SdW4oKX19IiwKICAgICAgICAicnVieSI6IGxhbWJkYSBjb2RlOiBmImV2YWwoQmFzZTY0LmRlY29kZTY0KCd7Y29kZX0nKSkiLAogICAgICAgICJodG1sIjogbGFtYmRhIGNvZGU6IGYiPCEtLSBiYXNlNjQgY29udGVudCAtLT5cbjxzY3JpcHQ+ZXZhbChhdG9iKCd7Y29kZX0nKSk8L3NjcmlwdD4iLAogICAgICAgICJqc29uIjogbGFtYmRhIGNvZGU6IGNvZGUsCiAgICAgICAgInhtbCI6IGxhbWJkYSBjb2RlOiBjb2RlLAogICAgICAgICJzcWwiOiBsYW1iZGEgY29kZTogZiItLSBiYXNlNjQgZW5jb2RlZCBTUUwgcXVlcnlcbi0tIGVjaG8gJ3tjb2RlfScgfCBiYXNlNjQgLWQgfCBzcWxpdGUzIG15ZGIuZGIiLAogICAgICAgICJvdGhlciI6IGxhbWJkYSBjb2RlOiBjb2RlLAogICAgfQoKICAgIGlmIG1vZGUgPT0gImZpbGUiOgogICAgICAgIGZvbGRlcl9wYXRoID0gUHJvbXB0LmFzaygiW2JvbGQgeWVsbG93XUVudGVyIHRoZSBmb2xkZXIgcGF0aCIpCiAgICAgICAgZmlsZW5hbWUgPSBQcm9tcHQuYXNrKCJbYm9sZCB5ZWxsb3ddRW50ZXIgdGhlIGZpbGUgbmFtZSAoZS5nLiwgc2NyaXB0LnB5KSIpCiAgICAgICAgZnVsbF9wYXRoID0gb3MucGF0aC5qb2luKGZvbGRlcl9wYXRoLnN0cmlwKCksIGZpbGVuYW1lLnN0cmlwKCkpCgogICAgICAgIGlmIG5vdCBvcy5wYXRoLmlzZmlsZShmdWxsX3BhdGgpOgogICAgICAgICAgICBjb25zb2xlLnByaW50KGYiW2JvbGQgcmVkXUVycm9yOlsvYm9sZCByZWRdIEZpbGUgbm90IGZvdW5kOiBbd2hpdGVde2Z1bGxfcGF0aH1bL3doaXRlXSIpCiAgICAgICAgICAgIHJldHVybgoKICAgICAgICBsYW5nX29wdGlvbnMgPSBsaXN0KGxhbmd1YWdlX3dyYXBwZXJzLmtleXMoKSkKICAgICAgICBzZWxlY3RlZF9sYW5nID0gUHJvbXB0LmFzaygKICAgICAgICAgICAgIltib2xkIGN5YW5dV2hhdCBpcyB0aGUgZmlsZSB0eXBlL2xhbmd1YWdlPyIsCiAgICAgICAgICAgIGNob2ljZXM9bGFuZ19vcHRpb25zLAogICAgICAgICAgICBkZWZhdWx0PSJvdGhlciIKICAgICAgICApCgogICAgICAgIHRyeToKICAgICAgICAgICAgd2l0aCBvcGVuKGZ1bGxfcGF0aCwgInJiIikgYXMgZjoKICAgICAgICAgICAgICAgIGRhdGEgPSBmLnJlYWQoKQoKICAgICAgICAgICAgZW5jb2RlZCA9IGJhc2U2NC5iNjRlbmNvZGUoZGF0YSkuZGVjb2RlKCJ1dGYtOCIpCiAgICAgICAgICAgIHdyYXBwZXIgPSBsYW5ndWFnZV93cmFwcGVyc1tzZWxlY3RlZF9sYW5nXShlbmNvZGVkKQoKICAgICAgICAgICAgbmFtZSwgZXh0ID0gb3MucGF0aC5zcGxpdGV4dChmaWxlbmFtZSkKICAgICAgICAgICAgb3V0cHV0X2ZpbGVuYW1lID0gZiJ7bmFtZX1fZW5jcnlwdGVke2V4dH0iCiAgICAgICAgICAgIG91dHB1dF9wYXRoID0gb3MucGF0aC5qb2luKGZvbGRlcl9wYXRoLCBvdXRwdXRfZmlsZW5hbWUpCgogICAgICAgICAgICB3aXRoIG9wZW4ob3V0cHV0X3BhdGgsICJ3IiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoKICAgICAgICAgICAgICAgIGYud3JpdGUod3JhcHBlcikKCiAgICAgICAgICAgIG9zLmNobW9kKG91dHB1dF9wYXRoLCAwbzc1NSkKCiAgICAgICAgICAgIGNvbnNvbGUucHJpbnQoUGFuZWwoCiAgICAgICAgICAgICAgICBmIltncmVlbl1FbmNyeXB0aW9uIHN1Y2Nlc3NmdWwhWy9ncmVlbl1cblxuIgogICAgICAgICAgICAgICAgZiJbY3lhbl1MYW5ndWFnZTpbL2N5YW5dIHtzZWxlY3RlZF9sYW5nLnVwcGVyKCl9XG4iCiAgICAgICAgICAgICAgICBmIltjeWFuXUVuY3J5cHRlZCBhczpbL2N5YW5dIHtvdXRwdXRfZmlsZW5hbWV9IiwKICAgICAgICAgICAgICAgIHRpdGxlPSJbYm9sZCBncmVlbl1Eb25lWy9ib2xkIGdyZWVuXSIsIGJvcmRlcl9zdHlsZT0iZ3JlZW4iLCBib3g9Ym94LlJPVU5ERUQKICAgICAgICAgICAgKSkKCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBjb25zb2xlLnByaW50KGYiW2JvbGQgcmVkXUVuY3J5cHRpb24gZmFpbGVkOiB7ZX1bL2JvbGQgcmVkXSIpCgogICAgZWxpZiBtb2RlID09ICJmb2xkZXIiOgogICAgICAgIGNvbnNvbGUucHJpbnQoIltib2xkIHJlZF1Gb2xkZXIgbW9kZSBiZWx1bSBtZW5kdWt1bmcgd3JhcHBlciBvdG9tYXRpcy4gR3VuYWthbiBtb2RlIGZpbGUgZHVsdSB1bnR1ayBiYWhhc2EgdGVydGVudHUuWy9ib2xkIHJlZF0iKQoKZGVmIGNoZWNrX215X2luZm8oKToKICAgIGltcG9ydCBwbGF0Zm9ybQogICAgZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUsIHRpbWVkZWx0YQoKICAgIGNvbnNvbGUucHJpbnQoUGFuZWwoIltib2xkIGN5YW5dR2F0aGVyaW5nIGRldmljZSBpbmZvcm1hdGlvbi4uLlsvYm9sZCBjeWFuXSIsIHRpdGxlPSJbYm9sZCBtYWdlbnRhXWNoZWNrLW15LWluZm9bL2JvbGQgbWFnZW50YV0iLCBib3JkZXJfc3R5bGU9ImN5YW4iKSkKCiAgICB0cnk6CiAgICAgICAgaXAgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vYXBpLmlwaWZ5Lm9yZyIpLnRleHQKICAgICAgICBnZW8gPSByZXF1ZXN0cy5nZXQoImh0dHA6Ly9pcC1hcGkuY29tL2pzb24iKS5qc29uKCkKICAgICAgICB0aW1lem9uZSA9IHRpbWUudHpuYW1lWzBdCgogICAgICAgICMgRXN0aW1hc2kgd2FrdHUgaW5zdGFsbCBUZXJtdXgKICAgICAgICBpbnN0YWxsX3RpbWVzdGFtcCA9IG9zLnBhdGguZ2V0Y3RpbWUoIi9kYXRhL2RhdGEvY29tLnRlcm11eC9maWxlcy9ob21lIikKICAgICAgICBpbnN0YWxsX2RhdGUgPSBkYXRldGltZS5mcm9tdGltZXN0YW1wKGluc3RhbGxfdGltZXN0YW1wKS5zdHJmdGltZSgnJVktJW0tJWQgJUg6JU06JVMnKQoKICAgICAgICAjIEFtYmlsIFJBTSAoZGFyaSAnZnJlZSAtbScpCiAgICAgICAgcmFtX291dHB1dCA9IG9zLnBvcGVuKCJmcmVlIC1tIikucmVhZCgpCiAgICAgICAgdG90YWxfcmFtID0gIlVua25vd24iCiAgICAgICAgZm9yIGxpbmUgaW4gcmFtX291dHB1dC5zcGxpdGxpbmVzKCk6CiAgICAgICAgICAgIGlmICJNZW06IiBpbiBsaW5lOgogICAgICAgICAgICAgICAgdG90YWxfcmFtID0gbGluZS5zcGxpdCgpWzFdICsgIiBNQiIKCiAgICAgICAgIyBDUFUgaW5mbyBkYXJpICdjYXQgL3Byb2MvY3B1aW5mbycKICAgICAgICBjcHVpbmZvID0gb3MucG9wZW4oImNhdCAvcHJvYy9jcHVpbmZvIHwgZ3JlcCAnbW9kZWwgbmFtZScgfCB1bmlxIikucmVhZCgpLnN0cmlwKCkuc3BsaXQoIjoiKVstMV0uc3RyaXAoKQoKICAgICAgICBpbmZvID0gZiIiIgpbYm9sZCBncmVlbl1Vc2VybmFtZSAgICAgICAgOlsvYm9sZCBncmVlbl0ge3VzZXJuYW1lfQpbYm9sZCBncmVlbl1QdWJsaWMgSVAgICAgICAgOlsvYm9sZCBncmVlbl0ge2lwfQpbYm9sZCBncmVlbl1PcGVyYXRpbmcgU3lzdGVtOlsvYm9sZCBncmVlbl0ge3BsYXRmb3JtLnN5c3RlbSgpfSB7cGxhdGZvcm0ucmVsZWFzZSgpfQpbYm9sZCBncmVlbl1LZXJuZWwgVmVyc2lvbiAgOlsvYm9sZCBncmVlbl0ge3BsYXRmb3JtLnZlcnNpb24oKX0KW2JvbGQgZ3JlZW5dSG9zdG5hbWUgICAgICAgIDpbL2JvbGQgZ3JlZW5dIHtwbGF0Zm9ybS5ub2RlKCl9Cltib2xkIGdyZWVuXUNQVSAgICAgICAgICAgICA6Wy9ib2xkIGdyZWVuXSB7Y3B1aW5mb30KW2JvbGQgZ3JlZW5dTWVtb3J5IChSQU0pICAgIDpbL2JvbGQgZ3JlZW5dIHt0b3RhbF9yYW19Cltib2xkIGdyZWVuXVRpbWV6b25lICAgICAgICA6Wy9ib2xkIGdyZWVuXSB7dGltZXpvbmV9Cltib2xkIGdyZWVuXUNhcnJpZXIgICAgICAgICA6Wy9ib2xkIGdyZWVuXSB7Z2VvLmdldCgnb3JnJywgJ1Vua25vd24nKX0KW2JvbGQgZ3JlZW5dSVNQICAgICAgICAgICAgIDpbL2JvbGQgZ3JlZW5dIHtnZW8uZ2V0KCdpc3AnLCAnVW5rbm93bicpfQpbYm9sZCBncmVlbl1DaXR5ICAgICAgICAgICAgOlsvYm9sZCBncmVlbl0ge2dlby5nZXQoJ2NpdHknLCAnVW5rbm93bicpfQpbYm9sZCBncmVlbl1SZWdpb24gICAgICAgICAgOlsvYm9sZCBncmVlbl0ge2dlby5nZXQoJ3JlZ2lvbk5hbWUnLCAnVW5rbm93bicpfQpbYm9sZCBncmVlbl1JbnN0YWxsZWQgU2luY2UgOlsvYm9sZCBncmVlbl0ge2luc3RhbGxfZGF0ZX0KICAgICAgICAiIiIKICAgICAgICBjb25zb2xlLnByaW50KFBhbmVsKGluZm8sIHRpdGxlPSJbYm9sZCB5ZWxsb3ddU3lzdGVtIE92ZXJ2aWV3Wy9ib2xkIHllbGxvd10iLCBib3JkZXJfc3R5bGU9ImJyaWdodF9tYWdlbnRhIiwgYm94PWJveC5ET1VCTEUpKQoKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBjb25zb2xlLnByaW50KGYiW2JvbGQgcmVkXUVycm9yIHdoaWxlIGZldGNoaW5nIGluZm9ybWF0aW9uOiB7ZX1bL2JvbGQgcmVkXSIpCgpkZWYgc2hvd19wcm9tcHQoKToKICAgIHdoaWxlIFRydWU6CiAgICAgICAgdXNlcl9pbnB1dCA9IFByb21wdC5hc2soZiJbYm9sZCByZWRd4pWt4pSA4pSA4pSA4om8W3llbGxvd117dXNlcm5hbWV9Wy95ZWxsb3dd4oCifuKJvVxu4pWw4pSA4pSA4pW84pygIikKICAgICAgICBpZiB1c2VyX2lucHV0ID09ICIxIiBvciB1c2VyX2lucHV0Lmxvd2VyKCkgPT0gImhlbHAiOgogICAgICAgICAgICBjbGVhcl9hbmRfaGVhZGVyKCkKICAgICAgICAgICAgc2hvd19oZWxwKCkKICAgICAgICBlbGlmIHVzZXJfaW5wdXQgPT0gIjIiIG9yIHVzZXJfaW5wdXQubG93ZXIoKSA9PSAic2V0dGluZ3MiOgogICAgICAgICAgICBjbGVhcl9hbmRfaGVhZGVyKCkKICAgICAgICAgICAgc2V0dGluZ3NfbWVudSgpCiAgICAgICAgZWxpZiB1c2VyX2lucHV0ID09ICIzIiBvciB1c2VyX2lucHV0Lmxvd2VyKCkgPT0gIndlYi1jaGVja3ZpcnVzIjoKICAgICAgICAgICAgY2xlYXJfYW5kX2hlYWRlcigpCiAgICAgICAgICAgIGNoZWNrX3ZpcnVzX2luX3VybCgpCiAgICAgICAgZWxpZiB1c2VyX2lucHV0ID09ICI0IiBvciB1c2VyX2lucHV0Lmxvd2VyKCkgPT0gIndlYi1sb29rdXAiOgogICAgICAgICAgICBjbGVhcl9hbmRfaGVhZGVyKCkKICAgICAgICAgICAgd2ViX2xvb2t1cCgpCiAgICAgICAgZWxpZiB1c2VyX2lucHV0ID09ICI1IiBvciB1c2VyX2lucHV0Lmxvd2VyKCkgPT0gImNoZWNrLXBvcnQiOgogICAgICAgICAgICBjbGVhcl9hbmRfaGVhZGVyKCkKICAgICAgICAgICAgcG9ydF9zY2FuKCkKICAgICAgICBlbGlmIHVzZXJfaW5wdXQgPT0gIjYiIG9yIHVzZXJfaW5wdXQubG93ZXIoKSA9PSAiZW5jcnlwdC1maWxlIjoKICAgICAgICAgICAgY2xlYXJfYW5kX2hlYWRlcigpCiAgICAgICAgICAgIGVuY3J5cHRfZmlsZSgpCiAgICAgICAgZWxpZiB1c2VyX2lucHV0ID09ICI3IiBvciB1c2VyX2lucHV0Lmxvd2VyKCkgPT0gImNoZWNrLW15LWluZm8iOgogICAgICAgICAgICBjbGVhcl9hbmRfaGVhZGVyKCkKICAgICAgICAgICAgY2hlY2tfbXlfaW5mbygpCiAgICAgICAgZWxpZiB1c2VyX2lucHV0ID09ICI4IiBvciB1c2VyX2lucHV0Lmxvd2VyKCkgPT0gImRlY3J5cHQtZmlsZSI6CiAgICAgICAgICAgIGNsZWFyX2FuZF9oZWFkZXIoKQogICAgICAgICAgICBkZWNyeXB0X2ZpbGUoKQogICAgICAgICAgICBjbGVhcl9hbmRfaGVhZGVyKCkKICAgICAgICAgICAgY2hlY2tfbXlfaW5mbygpCiAgICAgICAgZWxpZiB1c2VyX2lucHV0ID09ICIwIiBvciB1c2VyX2lucHV0Lmxvd2VyKCkgPT0gImV4aXQiOgogICAgICAgICAgICBjbGVhcl9hbmRfaGVhZGVyKCkKICAgICAgICAgICAgY29uc29sZS5wcmludCgiW2JvbGQgcmVkXUdvb2RieWUhIikKICAgICAgICAgICAgYnJlYWsKICAgICAgICBlbHNlOgogICAgICAgICAgICBjbGVhcl9hbmRfaGVhZGVyKCkKICAgICAgICAgICAgY29uc29sZS5wcmludCgiW2JvbGQgcmVkXVVua25vd24gY29tbWFuZC4gVHlwZSAnMScgb3IgJ2hlbHAnIHRvIGdldCBzdGFydGVkLiIpCgojIC4uLiAoc2VtdWEgaW1wb3J0IGRhbiBmdW5nc2kgbGFpbm55YSB0ZXRhcCkKCmRlZiBwb3J0X3NjYW4oKToKICAgIGNvbnNvbGUucHJpbnQoUGFuZWwoIltib2xkIGN5YW5dRW50ZXIgYSBkb21haW4gb3IgSVAgdG8gc2NhbjpbL2JvbGQgY3lhbl0iLCB0aXRsZT0iY2hlY2stcG9ydCIsIGJvcmRlcl9zdHlsZT0iY3lhbiIpKQogICAgdGFyZ2V0ID0gUHJvbXB0LmFzaygiW2JvbGQgeWVsbG93XVRhcmdldCAoZG9tYWluL0lQKSIpCiAgICBwYXJzZWQgPSB1cmxwYXJzZSh0YXJnZXQgaWYgIjovLyIgaW4gdGFyZ2V0IGVsc2UgZiJodHRwOi8ve3RhcmdldH0iKQogICAgaG9zdCA9IHBhcnNlZC5ob3N0bmFtZSBpZiBwYXJzZWQuaG9zdG5hbWUgZWxzZSB0YXJnZXQKICAgIHRyeToKICAgICAgICBpcCA9IHNvY2tldC5nZXRob3N0YnluYW1lKGhvc3QpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgY29uc29sZS5wcmludChmIltib2xkIHJlZF1FcnJvciByZXNvbHZpbmcgaG9zdDpbL2JvbGQgcmVkXSB7ZX0iKQogICAgICAgIHJldHVybgoKICAgIHN0YXJ0X3BvcnQgPSBpbnQoUHJvbXB0LmFzaygiW2JvbGQgY3lhbl1TdGFydCBwb3J0IiwgZGVmYXVsdD0iMSIpKQogICAgZW5kX3BvcnQgPSBpbnQoUHJvbXB0LmFzaygiW2JvbGQgY3lhbl1FbmQgcG9ydCIsIGRlZmF1bHQ9IjEwMjQiKSkKICAgIHRpbWVvdXQgPSAwLjQKCiAgICBvcGVuX3BvcnRzID0gW10KICAgIGZpbHRlcmVkX3BvcnRzID0gW10KICAgIGNsb3NlZF9wb3J0cyA9IFtdCgogICAgc3RhcnRfdGltZSA9IHRpbWUudGltZSgpCiAgICBjb25zb2xlLnByaW50KGYiW2JvbGQgY3lhbl1TY2FubmluZyB7aXB9ICh7aG9zdH0pIGZyb20gcG9ydCB7c3RhcnRfcG9ydH0gdG8ge2VuZF9wb3J0fS4uLlsvYm9sZCBjeWFuXSIpCgogICAgdHJ5OgogICAgICAgIGZvciBwb3J0IGluIHJhbmdlKHN0YXJ0X3BvcnQsIGVuZF9wb3J0ICsgMSk6CiAgICAgICAgICAgIHdpdGggc29ja2V0LnNvY2tldChzb2NrZXQuQUZfSU5FVCwgc29ja2V0LlNPQ0tfU1RSRUFNKSBhcyBzb2NrOgogICAgICAgICAgICAgICAgc29jay5zZXR0aW1lb3V0KHRpbWVvdXQpCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gc29jay5jb25uZWN0X2V4KChpcCwgcG9ydCkpCiAgICAgICAgICAgICAgICAgICAgaWYgcmVzdWx0ID09IDA6CiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlcnZpY2UgPSBzb2NrZXQuZ2V0c2VydmJ5cG9ydChwb3J0KQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXJ2aWNlID0gIlVua25vd24iCiAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5fcG9ydHMuYXBwZW5kKChwb3J0LCBzZXJ2aWNlKSkKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5wcmludChmIltib2xkIGdyZWVuXVtPUEVOXVsvYm9sZCBncmVlbl0gUG9ydCB7cG9ydH0gKHtzZXJ2aWNlfSkiKQogICAgICAgICAgICAgICAgICAgIGVsaWYgcmVzdWx0ID09IDExMSBvciByZXN1bHQgPT0gMTAwNjE6CiAgICAgICAgICAgICAgICAgICAgICAgIGNsb3NlZF9wb3J0cy5hcHBlbmQocG9ydCkKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5wcmludChmIltyZWRdW0NMT1NFRF1bL3JlZF0gUG9ydCB7cG9ydH0iKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcmVkX3BvcnRzLmFwcGVuZChwb3J0KQogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLnByaW50KGYiW3llbGxvd11bRklMVEVSRURdWy95ZWxsb3ddIFBvcnQge3BvcnR9IikKICAgICAgICAgICAgICAgIGV4Y2VwdCBzb2NrZXQudGltZW91dDoKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJlZF9wb3J0cy5hcHBlbmQocG9ydCkKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLnByaW50KGYiW3llbGxvd11bRklMVEVSRURdWy95ZWxsb3ddIFBvcnQge3BvcnR9IikKICAgIGV4Y2VwdCBLZXlib2FyZEludGVycnVwdDoKICAgICAgICBjb25zb2xlLnByaW50KCJcbltib2xkIHJlZF1TY2FuIGRpaGVudGlrYW4hIEN0cmwrQyBkaW5vbmFrdGlma2FuIHNlbGFtYSBzY2FuLlsvYm9sZCByZWRdIikKICAgICAgICByZXR1cm4KCiAgICBlbmRfdGltZSA9IHRpbWUudGltZSgpCiAgICBkdXJhdGlvbiA9IHJvdW5kKGVuZF90aW1lIC0gc3RhcnRfdGltZSwgMikKCiAgICAjIFJpbmdrYXNhbgogICAgY29uc29sZS5wcmludCgiXG5bYm9sZCBibHVlXT09PSBTY2FuIFN1bW1hcnkgPT09Wy9ib2xkIGJsdWVdIikKICAgIGNvbnNvbGUucHJpbnQoZiJbZ3JlZW5dT3BlbiBwb3J0cyAgIDoge2xlbihvcGVuX3BvcnRzKX1bL2dyZWVuXSIpCiAgICBjb25zb2xlLnByaW50KGYiW3JlZF1DbG9zZWQgcG9ydHMgOiB7bGVuKGNsb3NlZF9wb3J0cyl9Wy9yZWRdIikKICAgIGNvbnNvbGUucHJpbnQoZiJbeWVsbG93XUZpbHRlcmVkIHBvcnRzIDoge2xlbihmaWx0ZXJlZF9wb3J0cyl9Wy95ZWxsb3ddIikKICAgIGNvbnNvbGUucHJpbnQoZiJbY3lhbl1TY2FuIHRpbWUgICAgIDoge2R1cmF0aW9ufSBzZWNvbmRzWy9jeWFuXSIpCgogICAgIyBTaW1wYW4ga2UgZmlsZQogICAgd2l0aCBvcGVuKCJzY2FuX3Jlc3VsdHMudHh0IiwgInciKSBhcyBmOgogICAgICAgIGYud3JpdGUoZiJTY2FuIFJlc3VsdCBmb3Ige3RhcmdldH0gKHtpcH0pXG4iKQogICAgICAgIGYud3JpdGUoZiJTY2FubmVkIHBvcnRzOiB7c3RhcnRfcG9ydH3igJN7ZW5kX3BvcnR9XG4iKQogICAgICAgIGYud3JpdGUoZiJUaW1lOiB7ZHVyYXRpb259c1xuXG4iKQogICAgICAgIGYud3JpdGUoIk9wZW4gUG9ydHM6XG4iKQogICAgICAgIGZvciBwb3J0LCBzZXJ2aWNlIGluIG9wZW5fcG9ydHM6CiAgICAgICAgICAgIGYud3JpdGUoZiIgIFBvcnQge3BvcnR9ICh7c2VydmljZX0pXG4iKQogICAgICAgIGYud3JpdGUoIlxuQ2xvc2VkIFBvcnRzOlxuIikKICAgICAgICBmb3IgcG9ydCBpbiBjbG9zZWRfcG9ydHM6CiAgICAgICAgICAgIGYud3JpdGUoZiIgIFBvcnQge3BvcnR9XG4iKQogICAgICAgIGYud3JpdGUoIlxuRmlsdGVyZWQgUG9ydHM6XG4iKQogICAgICAgIGZvciBwb3J0IGluIGZpbHRlcmVkX3BvcnRzOgogICAgICAgICAgICBmLndyaXRlKGYiICBQb3J0IHtwb3J0fVxuIikKCiAgICBjb25zb2xlLnByaW50KCJbYm9sZCBncmVlbl1IYXNpbCBkaXNpbXBhbiBrZSAnc2Nhbl9yZXN1bHRzLnR4dCdbL2JvbGQgZ3JlZW5dIikKCiNibG9raXIgcGVuZW1wYXRhbiBzY3JpcHQKZGVmIHZhbGlkYXRlX3NjcmlwdF9sb2NhdGlvbigpOgogICAgaW1wb3J0IHNodXRpbAoKICAgIHRlcm11eF9ob21lID0gIi9kYXRhL2RhdGEvY29tLnRlcm11eC9maWxlcy9ob21lIgogICAgdGVybXV4X3Jvb3QgPSAiL2RhdGEvZGF0YS9jb20udGVybXV4IgogICAgY3VycmVudF9kaXIgPSBvcy5wYXRoLmFic3BhdGgob3MuZ2V0Y3dkKCkpLmxvd2VyKCkKCiAgICAjIExva2FzaSB5YW5nIGRpcGVyYm9sZWhrYW4gKHBlbmdndW5hIGJpYXNhICsgb3BlcmF0b3IvZGV2KQogICAgdmFsaWRfcGF0aHMgPSBbCiAgICAgICAgdGVybXV4X3Jvb3QsCiAgICAgICAgb3MucGF0aC5qb2luKHRlcm11eF9ob21lLCAiQ3dhYnMtIiksCiAgICAgICAgIi9zdG9yYWdlL2VtdWxhdGVkLzAvZGF0YS9Dd2FicyBwcm9qZWN0L3YxLjMuMCIsCiAgICBdCgogICAgIyBKaWthIHRlcm1hc3VrIGxva2FzaSBzYWgsIGxhbmp1dGthbiBla3Nla3VzaQogICAgZm9yIHBhdGggaW4gdmFsaWRfcGF0aHM6CiAgICAgICAgaWYgY3VycmVudF9kaXIuc3RhcnRzd2l0aChvcy5wYXRoLmFic3BhdGgocGF0aCkubG93ZXIoKSk6CiAgICAgICAgICAgIHJldHVybgoKICAgICMgTG9rYXNpIHRpZGFrIHNhaCDihpIgcGluZGFoa2FuIGZpbGUga2UgZm9sZGVyIHJlc21pCiAgICB0YXJnZXRfZGlyID0gb3MucGF0aC5qb2luKHRlcm11eF9ob21lLCAiQ3dhYnMtIikKICAgIG9zLm1ha2VkaXJzKHRhcmdldF9kaXIsIGV4aXN0X29rPVRydWUpCgogICAgc2NyaXB0X3BhdGggPSBvcy5wYXRoLmFic3BhdGgoX19maWxlX18pCiAgICBzY3JpcHRfbmFtZSA9ICJDd2Ficy5weSIKICAgIHJlcV9wYXRoID0gb3MucGF0aC5qb2luKG9zLnBhdGguZGlybmFtZShzY3JpcHRfcGF0aCksICJyZXF1aXJlbWVudHMudHh0IikKCiAgICB0cnk6CiAgICAgICAgIyBQaW5kYWhrYW4gZmlsZSBzY3JpcHQKICAgICAgICBzaHV0aWwuY29weTIoc2NyaXB0X3BhdGgsIG9zLnBhdGguam9pbih0YXJnZXRfZGlyLCBzY3JpcHRfbmFtZSkpCiAgICAgICAgb3MucmVtb3ZlKHNjcmlwdF9wYXRoKQoKICAgICAgICAjIFBpbmRhaGthbiByZXF1aXJlbWVudHMudHh0IGppa2EgYWRhCiAgICAgICAgaWYgb3MucGF0aC5pc2ZpbGUocmVxX3BhdGgpOgogICAgICAgICAgICBzaHV0aWwuY29weTIocmVxX3BhdGgsIG9zLnBhdGguam9pbih0YXJnZXRfZGlyLCAicmVxdWlyZW1lbnRzLnR4dCIpKQogICAgICAgICAgICBvcy5yZW1vdmUocmVxX3BhdGgpCgogICAgICAgIGNvbnNvbGUucHJpbnQoUGFuZWwoCiAgICAgICAgICAgICJbYm9sZCByZWRdVGhpcyBzY3JpcHQgY2FuIG9ubHkgYmUgZXhlY3V0ZWQgaW5zaWRlIHRoZSBUZXJtdXggZW52aXJvbm1lbnQuWy9ib2xkIHJlZF1cblxuIgogICAgICAgICAgICAiW2dyZWVuXVRoZSBuZWNlc3NhcnkgZmlsZXMgaGF2ZSBiZWVuIG1vdmVkIGF1dG9tYXRpY2FsbHkuWy9ncmVlbl1cbiIKICAgICAgICAgICAgIlt5ZWxsb3ddUGxlYXNlIHJlLXJ1biB0aGUgdG9vbCBmcm9tIHlvdXIgVGVybXV4IGhvbWUgZGlyZWN0b3J5LlsveWVsbG93XSIsCiAgICAgICAgICAgIHRpdGxlPSJbcmVkXUV4ZWN1dGlvbiBEZW5pZWRbL3JlZF0iLAogICAgICAgICAgICBib3JkZXJfc3R5bGU9InJlZCIKICAgICAgICApKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGNvbnNvbGUucHJpbnQoUGFuZWwoCiAgICAgICAgICAgIGYiW2JvbGQgcmVkXUZhaWxlZCB0byBtb3ZlIGZpbGVzOlsvYm9sZCByZWRdIHtlfSIsCiAgICAgICAgICAgIHRpdGxlPSJbcmVkXUZhdGFsIEVycm9yWy9yZWRdIiwKICAgICAgICAgICAgYm9yZGVyX3N0eWxlPSJicmlnaHRfcmVkIgogICAgICAgICkpCgogICAgc3lzLmV4aXQoMSkKCmRlZiBtYWluKCk6CiAgICB2YWxpZGF0ZV9zY3JpcHRfbG9jYXRpb24oKQogICAgY2xlYXJfc2NyZWVuKCkKICAgIGNvbnNvbGUucHJpbnQoZ2V0X2dyZWV0aW5nKCksIGp1c3RpZnk9ImxlZnQiKQogICAgcHJpbnQoKQogICAgcmFpbmJvd19maWdsZXQoIkN3YWJzIikKICAgIHByaW50KCkKICAgIHNob3dfcHJvbXB0KCkKCmlmIF9fbmFtZV9fID09ICJfX21haW5fXyI6CiAgICB0cnk6CiAgICAgICAgbWFpbigpCiAgICBleGNlcHQgS2V5Ym9hcmRJbnRlcnJ1cHQ6CiAgICAgICAgY29uc29sZS5wcmludCgiXG5bYm9sZCByZWRdU2NyaXB0IGludGVycnVwdGVkIGJ5IHVzZXIuIikKICAgICAgICBzeXMuZXhpdCgpCgpkZWYgZGV0ZWN0X2xhbmd1YWdlKGNvZGUpOgogICAgcGF0dGVybnMgPSB7CiAgICAgICAgIlB5dGhvbiI6IFsiZGVmICIsICJpbXBvcnQgIiwgInByaW50KCIsICJzZWxmIl0sCiAgICAgICAgIkMiOiBbIiNpbmNsdWRlIiwgImludCBtYWluIiwgInByaW50ZigiLCAic2NhbmYoIl0sCiAgICAgICAgIkMrKyI6IFsiI2luY2x1ZGUiLCAic3RkOjoiLCAiY291dCIsICJjaW4iXSwKICAgICAgICAiSmF2YSI6IFsicHVibGljIHN0YXRpYyB2b2lkIG1haW4iLCAiU3lzdGVtLm91dC5wcmludGxuIiwgImNsYXNzICJdLAogICAgICAgICJKYXZhU2NyaXB0IjogWyJmdW5jdGlvbigiLCAiY29uc29sZS5sb2ciLCAidmFyICIsICJsZXQgIiwgIj0+Il0sCiAgICAgICAgIkhUTUwiOiBbIjxodG1sPiIsICI8aGVhZD4iLCAiPGJvZHk+Il0sCiAgICAgICAgIkJhc2giOiBbIiMhL2Jpbi9iYXNoIiwgImVjaG8gIiwgImZpIiwgImlmIFsiXSwKICAgIH0KICAgIGZvciBsYW5nLCBrZXl3b3JkcyBpbiBwYXR0ZXJucy5pdGVtcygpOgogICAgICAgIGZvciBrZXl3b3JkIGluIGtleXdvcmRzOgogICAgICAgICAgICBpZiBrZXl3b3JkIGluIGNvZGU6CiAgICAgICAgICAgICAgICByZXR1cm4gbGFuZwogICAgcmV0dXJuICJVbmtub3duIgoKZGVmIGRlY3J5cHRfZmlsZSgpOgogICAgZnJvbSByaWNoLnBhbmVsIGltcG9ydCBQYW5lbAogICAgZnJvbSByaWNoLnRleHQgaW1wb3J0IFRleHQKICAgIGZyb20gcmljaCBpbXBvcnQgYm94CiAgICBpbXBvcnQgYmFzZTY0CiAgICBpbXBvcnQgb3MKCiAgICBjb25zb2xlLnByaW50KFBhbmVsKCJbYm9sZCBjeWFuXURFQ1JZUFQgRklMRVsvYm9sZCBjeWFuXVxuXG5FbnRlciBmb2xkZXIgcGF0aCBhbmQgZmlsZW5hbWUuIFRoaXMgdG9vbCB3aWxsIHRyeSB0byBkZXRlY3QgZW5jcnlwdGlvbiBtZXRob2QgYW5kIGxhbmd1YWdlLiIsCiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlPSJbYm9sZCByZWRdRGVjcnlwdG9yIEVuZ2luZSB2MVsvYm9sZCByZWRdIiwgYm9yZGVyX3N0eWxlPSJtYWdlbnRhIiwgYm94PWJveC5IRUFWWSkpCgogICAgZm9sZGVyID0gUHJvbXB0LmFzaygiW2JvbGQgeWVsbG93XUVudGVyIGZvbGRlciBwYXRoIChlLmcuLCBzdG9yYWdlL3NoYXJlZC9kYXRhKSIpCiAgICBuYW1lID0gUHJvbXB0LmFzaygiW2JvbGQgeWVsbG93XUVudGVyIGZpbGUgbmFtZSAoZS5nLiwgc3RhcnQpIikKCiAgICBmdWxsX3BhdGggPSBvcy5wYXRoLmpvaW4oZm9sZGVyLCBuYW1lKQoKICAgIGlmIG5vdCBvcy5wYXRoLmlzZmlsZShmdWxsX3BhdGgpOgogICAgICAgIGNvbnNvbGUucHJpbnQoZiJbYm9sZCByZWRdRmlsZSBub3QgZm91bmQ6IHtmdWxsX3BhdGh9Wy9ib2xkIHJlZF0iKQogICAgICAgIHJldHVybgoKICAgIHRyeToKICAgICAgICB3aXRoIG9wZW4oZnVsbF9wYXRoLCAicmIiKSBhcyBmOgogICAgICAgICAgICBjb250ZW50ID0gZi5yZWFkKCkKCiAgICAgICAgbGF5ZXIgPSAwCiAgICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZGVjb2RlZCA9IGJhc2U2NC5iNjRkZWNvZGUoY29udGVudCwgdmFsaWRhdGU9VHJ1ZSkKICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBkZWNvZGVkCiAgICAgICAgICAgICAgICBsYXllciArPSAxCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGJyZWFrCgogICAgICAgIGlmIGxheWVyID09IDA6CiAgICAgICAgICAgIGNvbnNvbGUucHJpbnQoIltib2xkIHJlZF1ObyBrbm93biBlbmNyeXB0aW9uIG1ldGhvZCBkZXRlY3RlZC5bL2JvbGQgcmVkXSIpCiAgICAgICAgICAgIHJldHVybgoKICAgICAgICB0cnk6CiAgICAgICAgICAgIGRlY29kZWRfdGV4dCA9IGNvbnRlbnQuZGVjb2RlKCJ1dGYtOCIsIGVycm9ycz0iaWdub3JlIikKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIGRlY29kZWRfdGV4dCA9IHN0cihjb250ZW50KQoKICAgICAgICBsYW5nID0gZGV0ZWN0X2xhbmd1YWdlKGRlY29kZWRfdGV4dCkKICAgICAgICBvdXRwdXRfZmlsZSA9IG9zLnBhdGguam9pbihvcy5nZXRjd2QoKSwgZiJ7bmFtZX1fZGVjcnlwdGVkLnR4dCIpCiAgICAgICAgd2l0aCBvcGVuKG91dHB1dF9maWxlLCAidyIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6CiAgICAgICAgICAgIGYud3JpdGUoZGVjb2RlZF90ZXh0KQoKICAgICAgICBjb25zb2xlLnByaW50KFBhbmVsKGYiW2dyZWVuXURlY3J5cHRpb24gc3VjY2Vzc2Z1bCFbL2dyZWVuXVxuW2N5YW5dRGV0ZWN0ZWQgbGF5ZXJzOlsvY3lhbl0ge2xheWVyfVxuW2N5YW5dRGV0ZWN0ZWQgbGFuZ3VhZ2U6Wy9jeWFuXSB7bGFuZ31cblt3aGl0ZV1TYXZlZCB0bzpbL3doaXRlXSB7b3V0cHV0X2ZpbGV9IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlPSJbYm9sZCBncmVlbl1TdWNjZXNzWy9ib2xkIGdyZWVuXSIsIGJvcmRlcl9zdHlsZT0iZ3JlZW4iLCBib3g9Ym94LlJPVU5ERUQpKQoKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBjb25zb2xlLnByaW50KGYiW2JvbGQgcmVkXUZhaWxlZCB0byBkZWNyeXB0OiB7ZX1bL2JvbGQgcmVkXSIpCg=='''))